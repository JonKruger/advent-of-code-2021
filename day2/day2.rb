def input
    raw_input = "
    forward 4
    down 9
    forward 6
    down 5
    up 2
    forward 5
    forward 7
    up 5
    down 9
    up 6
    down 6
    down 1
    down 1
    up 2
    down 3
    up 3
    forward 8
    forward 7
    down 6
    down 7
    forward 6
    forward 9
    forward 7
    up 9
    down 4
    down 6
    down 5
    down 9
    forward 8
    down 9
    forward 9
    forward 4
    forward 4
    up 3
    up 8
    down 9
    down 8
    down 4
    forward 5
    forward 4
    up 6
    forward 6
    up 3
    up 8
    up 3
    up 4
    down 3
    down 5
    down 5
    up 1
    forward 9
    down 4
    forward 6
    down 6
    up 2
    up 9
    forward 1
    forward 2
    forward 7
    down 6
    up 6
    forward 1
    forward 7
    down 7
    forward 9
    forward 4
    forward 6
    down 5
    up 9
    down 1
    up 5
    up 5
    up 9
    down 5
    forward 7
    down 1
    up 9
    down 7
    forward 2
    down 4
    down 4
    forward 8
    forward 8
    down 6
    down 3
    up 7
    down 3
    forward 9
    down 7
    forward 2
    down 1
    forward 5
    up 9
    down 2
    up 2
    down 3
    up 7
    forward 9
    forward 7
    down 4
    down 5
    up 3
    down 3
    down 5
    forward 9
    down 3
    forward 9
    down 3
    up 9
    down 5
    forward 4
    down 4
    up 8
    forward 7
    up 1
    down 2
    forward 4
    down 7
    down 9
    down 4
    down 4
    forward 6
    down 7
    down 2
    down 1
    forward 1
    down 2
    forward 1
    down 7
    forward 5
    up 3
    forward 6
    up 9
    down 3
    down 3
    down 9
    forward 4
    down 4
    forward 9
    forward 6
    down 7
    up 9
    up 6
    forward 4
    down 5
    forward 2
    down 7
    down 7
    forward 4
    forward 5
    down 8
    down 5
    up 4
    forward 7
    up 8
    down 8
    forward 4
    forward 5
    down 6
    down 1
    down 1
    down 9
    forward 4
    up 1
    down 8
    up 7
    down 1
    up 2
    forward 4
    down 7
    down 7
    down 2
    forward 7
    down 2
    up 1
    up 4
    down 6
    forward 5
    forward 2
    up 1
    forward 2
    forward 9
    up 9
    up 7
    forward 9
    down 8
    up 5
    down 6
    down 6
    up 8
    down 1
    forward 6
    down 5
    forward 2
    down 9
    down 9
    up 4
    forward 4
    forward 2
    forward 7
    forward 3
    down 1
    forward 8
    up 9
    down 7
    forward 9
    forward 1
    forward 5
    up 6
    down 6
    forward 6
    up 3
    forward 9
    down 3
    forward 2
    down 7
    down 3
    up 9
    down 2
    down 3
    forward 5
    down 9
    forward 8
    down 2
    forward 1
    down 9
    down 7
    forward 2
    forward 6
    forward 4
    forward 5
    down 5
    down 1
    forward 5
    up 4
    down 4
    up 8
    down 4
    up 4
    down 1
    down 2
    down 9
    down 2
    up 4
    down 1
    forward 2
    forward 1
    forward 9
    down 5
    up 4
    up 1
    forward 8
    forward 6
    forward 9
    up 9
    forward 4
    forward 4
    down 1
    forward 6
    forward 7
    forward 3
    up 5
    up 7
    down 1
    forward 4
    down 3
    down 5
    up 7
    down 4
    up 9
    down 3
    down 5
    forward 7
    forward 8
    up 5
    up 1
    forward 3
    up 8
    forward 3
    down 2
    forward 1
    forward 9
    forward 1
    down 2
    forward 7
    down 5
    forward 6
    down 9
    up 9
    forward 5
    forward 7
    forward 6
    down 2
    up 2
    forward 3
    forward 4
    forward 3
    down 5
    forward 1
    forward 2
    forward 6
    down 4
    forward 2
    forward 6
    up 8
    forward 2
    up 4
    forward 7
    down 2
    forward 1
    forward 7
    down 6
    forward 4
    down 3
    down 2
    down 2
    forward 4
    down 8
    forward 6
    forward 6
    down 2
    up 3
    up 1
    forward 1
    down 5
    down 2
    forward 4
    forward 7
    forward 3
    down 3
    forward 9
    down 1
    down 7
    forward 6
    forward 1
    up 6
    forward 7
    forward 1
    down 5
    down 4
    forward 6
    up 1
    down 1
    up 9
    down 2
    down 2
    forward 3
    up 4
    down 5
    down 5
    down 3
    down 6
    up 8
    forward 2
    forward 2
    down 6
    down 1
    up 4
    up 1
    down 5
    up 4
    up 2
    forward 4
    forward 6
    forward 3
    down 7
    forward 8
    up 5
    forward 5
    down 1
    forward 2
    forward 6
    down 8
    up 6
    down 1
    down 7
    forward 4
    forward 2
    up 1
    down 6
    forward 3
    forward 1
    forward 5
    forward 9
    forward 9
    down 4
    forward 2
    down 1
    forward 1
    forward 7
    forward 5
    down 9
    down 8
    down 1
    down 6
    down 1
    up 7
    down 3
    forward 3
    up 6
    up 4
    down 7
    down 7
    forward 6
    up 7
    down 7
    forward 9
    down 9
    down 3
    forward 6
    forward 9
    forward 1
    down 4
    forward 5
    down 4
    down 2
    down 3
    up 3
    forward 9
    forward 7
    forward 5
    down 5
    forward 7
    up 4
    down 1
    forward 3
    down 3
    forward 4
    down 9
    forward 2
    down 5
    down 1
    forward 8
    down 3
    forward 7
    up 1
    down 3
    forward 2
    up 8
    down 2
    forward 4
    forward 4
    forward 4
    down 5
    up 6
    down 3
    forward 5
    down 4
    up 5
    forward 1
    forward 6
    up 1
    down 3
    forward 2
    forward 9
    down 7
    down 4
    forward 5
    up 3
    up 6
    up 1
    forward 4
    forward 1
    forward 1
    down 7
    up 4
    down 3
    down 8
    down 3
    forward 8
    forward 3
    down 6
    down 9
    forward 3
    forward 9
    forward 7
    down 8
    down 6
    down 4
    forward 2
    up 4
    forward 8
    down 1
    forward 9
    forward 1
    down 9
    forward 2
    down 7
    down 2
    up 7
    down 1
    up 8
    forward 8
    down 7
    forward 1
    down 1
    forward 3
    forward 1
    up 2
    down 7
    down 5
    forward 5
    down 8
    forward 4
    down 1
    up 2
    up 8
    down 8
    down 1
    down 5
    up 3
    forward 3
    forward 5
    down 2
    up 4
    down 2
    forward 7
    forward 9
    up 9
    up 7
    forward 1
    up 4
    forward 3
    up 5
    forward 9
    forward 9
    forward 6
    forward 2
    down 7
    forward 8
    forward 4
    forward 7
    down 8
    down 5
    down 6
    forward 6
    down 4
    down 1
    down 9
    down 1
    forward 3
    forward 5
    down 6
    down 7
    down 9
    down 8
    down 4
    up 5
    forward 7
    down 9
    forward 6
    down 7
    forward 5
    down 5
    forward 1
    down 5
    down 3
    up 9
    up 3
    forward 2
    up 9
    forward 6
    down 1
    down 5
    down 9
    down 4
    up 6
    forward 9
    down 4
    down 9
    down 5
    down 8
    down 5
    down 4
    up 5
    down 8
    up 8
    forward 5
    down 9
    forward 2
    up 2
    down 6
    forward 2
    forward 4
    forward 6
    down 6
    down 1
    forward 8
    down 5
    down 5
    forward 2
    down 7
    down 5
    down 6
    down 9
    forward 4
    up 9
    down 3
    down 7
    forward 3
    down 5
    up 1
    forward 5
    up 2
    down 2
    forward 2
    up 3
    up 6
    forward 2
    forward 7
    down 8
    forward 8
    forward 7
    forward 6
    down 5
    down 6
    down 6
    down 9
    up 5
    down 3
    up 1
    up 9
    up 5
    down 4
    down 4
    down 8
    forward 8
    up 5
    down 9
    forward 1
    up 1
    forward 2
    down 9
    forward 5
    up 9
    forward 7
    down 7
    down 5
    up 1
    up 2
    down 8
    down 7
    up 4
    forward 9
    down 4
    up 8
    down 5
    down 1
    forward 9
    down 6
    up 8
    down 6
    forward 7
    up 6
    up 5
    forward 2
    up 7
    forward 7
    forward 5
    down 1
    forward 9
    down 8
    forward 9
    down 3
    down 3
    forward 9
    up 1
    down 2
    forward 9
    down 7
    forward 4
    forward 3
    forward 4
    down 5
    forward 9
    forward 9
    down 5
    forward 4
    down 5
    down 2
    down 6
    forward 5
    forward 8
    forward 6
    up 9
    down 9
    forward 7
    down 6
    down 7
    down 4
    forward 1
    forward 3
    forward 6
    forward 4
    forward 3
    forward 4
    down 1
    forward 2
    forward 3
    forward 9
    up 8
    forward 6
    down 1
    up 5
    down 1
    down 4
    down 7
    down 5
    down 9
    down 2
    down 9
    forward 2
    down 2
    up 5
    forward 2
    forward 3
    forward 5
    up 8
    up 1
    down 9
    forward 2
    down 4
    down 9
    down 6
    down 5
    down 8
    forward 3
    forward 8
    forward 7
    up 3
    up 5
    down 9
    down 5
    up 6
    forward 4
    forward 4
    forward 4
    down 9
    down 2
    down 7
    down 1
    down 2
    down 4
    forward 7
    down 9
    forward 4
    forward 5
    up 5
    forward 4
    forward 9
    forward 1
    forward 5
    down 3
    forward 1
    forward 5
    up 9
    down 7
    forward 7
    forward 6
    down 2
    down 3
    forward 9
    down 1
    forward 4
    forward 9
    up 7
    forward 7
    down 5
    forward 9
    forward 2
    up 3
    down 3
    down 7
    down 5
    up 7
    up 9
    up 7
    forward 3
    forward 3
    forward 8
    up 9
    forward 8
    forward 9
    forward 4
    down 2
    forward 7
    down 6
    up 3
    up 9
    forward 8
    forward 2
    down 9
    down 7
    forward 1
    up 4
    up 7
    forward 2
    up 4
    forward 4
    up 1
    forward 3
    down 7
    forward 5
    down 4
    forward 2
    forward 7
    up 4
    down 1
    down 6
    forward 1
    forward 9
    up 6
    forward 7
    forward 7
    down 8
    forward 7
    down 8
    down 9
    up 3
    forward 3
    forward 3
    down 8
    up 2
    down 2
    down 4
    up 3
    down 3
    forward 7
    down 4
    up 8
    down 9
    down 9
    up 7
    down 1
    forward 2
    up 1
    down 3
    up 9
    down 6
    up 2
    forward 6
    up 8
    up 1
    down 6
    down 1
    up 6
    up 4
    up 2
    forward 6
    down 6
    down 1
    forward 7
    up 9
    up 1
    forward 4
    forward 5
    up 6
    forward 9
    down 1
    down 9
    down 3
    down 7
    forward 7
    down 1
    down 4
    forward 6
    down 5
    up 4
    forward 9
    up 5
    down 1
    down 2
    down 2
    up 4
    forward 1
    forward 3
    down 7
    forward 4
    down 4
    down 8
    down 5
    forward 3
    up 4
    forward 5
    down 2
    down 4
    down 4
    down 1
    forward 2
    forward 1
    forward 8
    forward 4
    up 4
    down 9
    up 6
    forward 9
    up 5
    down 5
    forward 3
    up 1
    forward 7
    down 4
    forward 7
    down 9
    up 8
    down 5
    forward 1
    down 5
    down 8
    forward 3
    up 6
    forward 3
    up 7
    forward 6
    forward 9
    up 1
    down 3
    down 9
    up 4
    up 6
    forward 5
    down 6
    down 3
    down 4
    up 1
    forward 5
    down 5
    down 2
    forward 6
    down 8
    down 3
    up 8
    forward 5
    forward 6
    down 6
    down 6
    down 6
    forward 7
    up 4
    forward 7
    up 4
    down 2
    forward 4
    forward 2
    down 6
    up 1
    down 1
    down 4
    up 8
    down 6
    forward 3
    forward 6
    down 6
    forward 5
    down 4
    up 2
    up 3
    down 3
    up 1
    forward 2
    up 1
    forward 4
    up 5
    up 2
    down 7
    forward 3
    up 2
    forward 5
    down 1
    down 3
    down 2
    forward 5
    down 1
    up 5
    forward 4
    down 7
    up 8
    up 3
    down 7
    down 7
    forward 9
    forward 1
    up 6
    down 4
    down 7
    forward 1
    down 4
    forward 9
    up 1
    forward 3
    down 1
    up 3
    down 6
    down 8
    down 6
    forward 6
    forward 6
    up 2
    down 8
    forward 5"
    raw_input.split("\n").select { |i| i.size > 0}
end  


def part1
    details = input.map do |command|
        direction, amount = command.split(' ')
        amount = amount.to_i
        if direction == "forward"
            change = {h: amount, v: 0}
        elsif direction == "up"
            change = {h: 0, v: -amount}
        elsif direction == "down"
            change = {h: 0, v: amount}
        else
            raise "unknown: #{command}"     
        end  
        change    
    end
    (details.map { |d| d[:h]}.sum * details.map { |d| d[:v]}.sum)
end

class Calculator
    attr_reader :aim, :hpos, :depth
    def initialize
        @aim = 0
        @hpos = 0
        @depth = 0
    end

    def process(command)
        # down X increases your aim by X units.
        # up X decreases your aim by X units.
        # forward X does two things:
        # It increases your horizontal position by X units.
        # It increases your depth by your aim multiplied by X.

        direction, amount = command.split(' ')
        amount = amount.to_i
        if direction == "forward"
            change = {hpos: amount, depth: aim * amount, aim: 0}
        elsif direction == "up"
            change = {hpos: 0, depth: 0, aim: -amount}
        elsif direction == "down"
            change = {hpos: 0, depth: 0, aim: amount}
        else
            raise "unknown: #{command}"     
        end  
        @aim += change[:aim]
        @hpos += change[:hpos]
        @depth += change[:depth]
    end
end

calculator = Calculator.new
# forward 5 adds 5 to your horizontal position, a total of 5. Because your aim is 0, your depth does not change.
calculator.process("forward 5")
raise if calculator.aim != 0
raise if calculator.hpos != 5
raise if calculator.depth != 0
# down 5 adds 5 to your aim, resulting in a value of 5.
calculator.process("down 5")
raise if calculator.aim != 5
# forward 8 adds 8 to your horizontal position, a total of 13. Because your aim is 5, your depth increases by 8*5=40.
calculator.process("forward 8")
raise if calculator.aim != 5
raise if calculator.hpos != 13
raise if calculator.depth != 40
# up 3 decreases your aim by 3, resulting in a value of 2.
calculator.process("up 3")
raise if calculator.aim != 2
# down 8 adds 8 to your aim, resulting in a value of 10.
calculator.process("down 8")
raise if calculator.aim != 10
# forward 2 adds 2 to your horizontal position, a total of 15. Because your aim is 10, your depth increases by 2*10=20 to a total of 60.
calculator.process("forward 2")
raise if calculator.hpos != 15
raise if calculator.aim != 10
raise if calculator.depth != 60

def part2
    calculator = Calculator.new
    input.each { |command| calculator.process(command) }
    puts calculator.hpos * calculator.depth
end
part2